{% extends 'MaestroCoreBundle::default.html.twig' %}
{% block title %}Listado de Establecimientos{% endblock %}
{% block body %}
 <div id="tabla"></div>   
<script>
$("#tabla").jsGrid({
    width: "100%",
    height: "400px",
    filtering: true,
    editing: false,
    inserting: false,
    sorting: true,
    paging: true,
    autoload: true,
    pageSize: 15,
    pageButtonCount: 5,
    paging: true,
    pageNextText: "Siguiente",
    pagePrevText: "Anterior",
    pageFirstText: "Primeros",
    pageLastText: "Ultimos",

    data: db.todos,

    fields: [
        { name: "Region", type: "text", width: 100 },
        { name: "SIBASI", type: "text", width: 100 },
        { name: "Red", type: "select", items: db.red, valueField: "id", textField: "nombre" },
        { name: "Establecimiento", type: "text", width: 200 },
        { name: "ECOS", type: "text", width: "5" }
    ]
});
    </script>
{% if is_granted('ROLE_AGREGA') %}
<a href="{{ path('establecimiento_add') }}" class="btn btn-primary">Agregar Establecimiento</a>
{% endif %}
{% endblock %}
{% block footer_js %}<script type="text/javascript">$(function(){ var oTable2 = $('#sample-table').dataTable(); })</script>{% endblock %}

{% block head_css %}
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/') }}css/grid/jsgrid.css" />
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/') }}css/grid/theme.css" />
    <script type="text/javascript">

    (function() {

    var db = {

        loadData: function(filter) {
            return $.grep(this.clients, function(client) {
                return (!filter.Name || client.Name.indexOf(filter.Name) > -1)
                    && (filter.Age === undefined || client.Age === filter.Age)
                    && (!filter.Address || client.Address.indexOf(filter.Address) > -1)
                    && (!filter.Country || client.Country === filter.Country)
                    && (filter.Married === undefined || client.Married === filter.Married);
            });
        },

        insertItem: function(insertingClient) {
            this.clients.push(insertingClient);
        },

        updateItem: function(updatingClient) { },

        deleteItem: function(deletingClient) {
            var clientIndex = $.inArray(deletingClient, this.clients);
            this.clients.splice(clientIndex, 1);
        }

    };

    window.db = db;

    db.red = [ { nombre: "", id: 0 }{% for e in red %},{ nombre: "{{e.nombre}}", id:{{e.id}}  }{% endfor %} ];
	
    db.todos = [ { nombre: "", id: 0 }
		{% for e in ctlEstablecimientos %},
			{ Region:"{% if 'Re' in e.direccion %}{{ e.direccion }}{% endif %}", SIBASI:"{{e.telefono}}", Red:{% if e.idestablesumeve > 0 %}{{e.idestablesumeve}}{% else %}0{% endif %}, Establecimiento: "{{e.nombre}}", ECOS:"{% set t = false %}{% for m in eco %}{% if e.id == m.establecimiento %}{% set t = true %}{% endif %}{% endfor %}{% if t%}Si{% else %}No{% endif %}"  }
		{% endfor %} ];


}());
    </script>
    <script src="{{ asset('assets/') }}js/grid/src/jsgrid.core.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/jsgrid.load-indicator.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/jsgrid.load-strategies.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/jsgrid.sort-strategies.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/jsgrid.field.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/fields/jsgrid.field.text.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/fields/jsgrid.field.number.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/fields/jsgrid.field.select.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/fields/jsgrid.field.checkbox.js"></script>
    <script src="{{ asset('assets/') }}js/grid/src/fields/jsgrid.field.control.js"></script>
{% endblock %}
