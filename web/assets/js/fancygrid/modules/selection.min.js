Fancy.define("Fancy.grid.plugin.Selection",{extend:Fancy.Plugin,ptype:"grid.selection",inWidgetName:"selection",mixins:["Fancy.grid.selection.mixin.Navigation"],enabled:!0,checkboxRow:!1,constructor:function(a){var b=this;b.Super("const",arguments)},init:function(){var a=this;a.Super("init",arguments),a.ons()},ons:function(){var a=this,b=a.widget;b.once("render",function(){a.initTrackOver(),a.initColumnTrackOver(),a.initCellTrackOver(),a.initCellSelection(),a.initRowSelection(),a.initColumnSelection(),b.keyNavigation&&a.initNavigation(),b.on("changepage",a.onChangePage,a)}),b.on("sort",a.onSort,a)},initTrackOver:function(){var a=this,b=a.widget;b.on("rowenter",a.onRowEnter,a),b.on("rowleave",a.onRowLeave,a)},initCellTrackOver:function(){var a=this,b=a.widget;b.on("cellenter",a.onCellEnter,a),b.on("cellleave",a.onCellLeave,a)},initColumnTrackOver:function(){var a=this,b=a.widget;b.on("columnenter",a.onColumnEnter,a),b.on("columnleave",a.onColumnLeave,a)},onCellEnter:function(a,b){var c=this,d=c.widget;if(d.cellTrackOver){var e=Fancy.get(b.cell);e.addClass(d.cellOverCls)}},onCellLeave:function(a,b){var c=this,d=c.widget;if(d.cellTrackOver){var e=Fancy.get(b.cell);e.removeClass(d.cellOverCls)}},onColumnEnter:function(a,b){var c=this,d=c.widget,e=d.scroller;if(d.columnTrackOver&&!e.bottomKnobDown&&!e.rightKnobDown&&b.column.trackOver!==!1){var f=Fancy.get(b.columnDom);f.addClass(d.columnOverCls)}},onColumnLeave:function(a,b){var c=this,d=c.widget;if(d.columnTrackOver){var e=Fancy.get(b.columnDom);e.removeClass(d.columnOverCls)}},onRowEnter:function(a,b){var c=this,d=c.widget,e=d.scroller;if(c.enabled!==!1&&d.trackOver&&!e.bottomKnobDown&&!e.rightKnobDown){for(var f=d.getDomRow(b.rowIndex),g=0,h=f.length;h>g;g++)Fancy.get(f[g]).addClass(d.rowOverCls);d.fire("rowtrackenter",b)}},onRowLeave:function(a,b){var c=this,d=c.widget;if(c.enabled!==!1&&d.trackOver){for(var e=d.getDomRow(b.rowIndex),f=0,g=e.length;g>f;f++)Fancy.get(e[f]).removeClass(d.rowOverCls);d.fire("rowtrackleave",b)}},onChangePage:function(){this.clearSelection()},initCellSelection:function(){var a=this,b=a.widget;b.on("cellclick",a.onCellClick,a),b.on("cellmousedown",a.onCellMouseDownCells,a),b.on("cellenter",a.onCellEnterSelection,a)},initRowSelection:function(){var a=this,b=a.widget;b.checkboxRowSelection&&(a.checkboxRow=!0,setTimeout(function(){a.renderHeaderCheckBox()})),b.on("rowclick",a.onRowClick,a),b.on("cellmousedown",a.onCellMouseDownRows,a),b.on("cellclick",a.onCellClickRows,a),b.on("rowenter",a.onRowEnterSelection,a)},onCellMouseDownRows:function(a,b){var c=this,d=c.widget;if(c.rows&&c.enabled){var e=b.e,f=e.target,g=e.ctrlKey,h=b.rowIndex,i=d.getDomRow(h);i.length;if(g&&d.multiSelect)Fancy.get(i[0]).hasClass(d.cellSelectedCls)?(c.domDeSelectRow(h),c.checkboxRow&&c.deSelectCheckBox(h)):(c.domSelectRow(h),c.checkboxRow&&c.selectCheckBox(h));else if("$selected"===b.column.index){var j=Fancy.getWidget(Fancy.get(b.cell).select(".fancy-field-checkbox").attr("id"));j.el.within(f)?(c.domSelectRow(h),j.get()===!0?c.domDeSelectRow(h):c.domSelectRow(h)):(c.clearSelection(),c.domSelectRow(h),c.checkboxRow&&c.selectCheckBox(h))}else c.clearSelection(),c.domSelectRow(h),c.checkboxRow&&c.selectCheckBox(h);c.isMouseDown=!0,c.startRowSelection=h,Fancy.$(document).one("mouseup",function(){delete c.isMouseDown,delete c.startCellSelection}),d.fire("select")}},onCellClickRows:function(a,b){var c=this,d=c.widget;if(c.rows&&c.enabled){var e=b.e,f=e.ctrlKey,g=b.rowIndex,h=d.getDomRow(g);h.length;if(f&&d.multiSelect);else if("$selected"===b.column.index){var i=Fancy.getWidget(Fancy.get(b.cell).select(".fancy-field-checkbox").attr("id"));i.get()===!0?c.selectCheckBox(g):c.deSelectCheckBox(g)}}},selectCheckBox:function(a){for(var b=this,c=b.widget,d=c.el.select('.fancy-grid-cell-select .fancy-grid-cell[index="'+a+'"] .fancy-field-checkbox'),e=0,f=d.length;f>e;e++){var g=Fancy.getWidget(d.item(e).attr("id"));g.set(!0)}b.clearHeaderCheckBox()},deSelectCheckBox:function(a){for(var b=this,c=b.widget,d=c.el.select('.fancy-grid-cell-select .fancy-grid-cell[index="'+a+'"] .fancy-field-checkbox'),e=0,f=d.length;f>e;e++){var g=Fancy.getWidget(d.item(e).attr("id"));g.set(!1)}b.clearHeaderCheckBox()},domSelectRow:function(a){for(var b=this,c=b.widget,d=c.getDomRow(a),e=0,f=d.length;f>e;e++)Fancy.get(d[e]).addClass(c.cellSelectedCls)},domDeSelectRow:function(a){for(var b=this,c=b.widget,d=c.getDomRow(a),e=0,f=d.length;f>e;e++)Fancy.get(d[e]).removeClass(c.cellSelectedCls)},onColumnEnterSelection:function(a,b){var c=this,d=c.widget;if(c.columns&&c.isMouseDown===!0){var e={columnIndex:c.startColumnColumnIndex,side:c.startColumnSide},f={columnIndex:b.columnIndex,side:b.side};if(e.side===f.side){switch(e.side){case"center":c.clearSelection("right"),c.clearSelection("left");break;case"left":c.clearSelection("center"),c.clearSelection("right");break;case"right":c.clearSelection("center"),c.clearSelection("left")}c.selectColumns(e.columnIndex,f.columnIndex,e.side)}else"center"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"center"===e.side&&"left"===f.side?(c.selectColumns(0,e.columnIndex,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left")):"left"===e.side&&"center"===f.side?(c.clearSelection("right"),c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,f.columnIndex,"center")):"left"===e.side&&"right"===f.side?(c.selectColumns(e.columnIndex,d.leftColumns.length,"left"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(0,f.columnIndex,"right")):"right"===e.side&&"center"===f.side?(c.clearSelection("left"),c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(f.columnIndex,d.columns.length,"center")):"right"===e.side&&"left"===f.side&&(c.selectColumns(0,e.columnIndex,"right"),c.selectColumns(0,d.columns.length,"center"),c.selectColumns(f.columnIndex,d.leftColumns.length,"left"))}},onRowEnterSelection:function(a,b){var c=this,d=c.widget;if(c.enabled!==!1&&c.rows&&c.isMouseDown===!0){var e=d.getDomRow(b.rowIndex),f=(e.length,c.startRowSelection),g=b.rowIndex,h={};f>g&&(f=b.rowIndex,g=c.startRowSelection);for(var i=f,j=g+1;j>i;i++)h[i]=!0;var k=c.getSelectedRowByColumn(b.columnIndex,b.side),l={},m={};for(var n in h)k[n]!==!0&&(l[n]=!0);for(var n in k)h[n]!==!0&&(m[n]=!0);for(var n in l)c.domSelectRow(n),c.checkboxRow&&c.selectCheckBox(n);for(var n in m)c.domDeSelectRow(n),c.checkboxRow&&c.deSelectCheckBox(n);d.fire("select")}},getSelectedRowByColumn:function(a,b){var c,d=this,e=d.widget;switch(b){case"left":c=e.leftBody;break;case"center":c=e.body;break;case"right":c=e.rightBody}for(var f=c.el.select('.fancy-grid-column[index="'+a+'"][grid="'+e.id+'"]'),g=f.select("."+e.cellSelectedCls),h={},i=0,j=g.length;j>i;i++)h[Number(g.item(i).attr("index"))]=!0;return h},getSelectedRow:function(){var a=this,b=a.widget,c=b.body,d=c.el.select("."+b.cellSelectedCls);return 0===d.length?-1:Number(d.item(0).attr("index"))},getSelectedRows:function(){for(var a=this,b=a.widget,c=b.body,d=c.el.select('.fancy-grid-column[index="0"][grid="'+b.id+'"]'),e=d.select("."+b.cellSelectedCls),f=[],g=0,h=e.length;h>g;g++)f.push(Number(e.item(g).attr("index")));return f},initColumnSelection:function(){var a=this,b=a.widget;a.selectedColumns=[],b.on("columnclick",a.onColumnClick,a),b.on("columnmousedown",a.onColumnMouseDown,a),b.on("columnenter",a.onColumnEnterSelection,a)},onColumnClick:function(a,b){var c=this,d=c.widget;if(c.column&&b.column.selectable!==!1){var e=Fancy.get(b.columnDom);c.column&&(c.selectedColumns[0]=b),c.clearSelection(),e.addClass(d.columnSelectedCls)}},onRowClick:function(a,b){var c=this,d=c.widget;if(c.row&&b!==!1){var e=b.column,f=!0;if("action"===e.type&&e.items)for(var g=0,h=e.items.length;h>g;g++)"remove"===e.items[g].action&&(f=!1);var i=d.getDomRow(b.rowIndex),j=0,k=i.length;if(c.clearSelection(),f){for(;k>j;j++)Fancy.get(i[j]).addClass(d.cellSelectedCls);d.fire("select")}}},selectRow:function(a){var b=this,c=b.widget;if(!b.row&&!b.rows)throw new Error("[FancyGrid Error] - row selection was not enabled");b.clearSelection();for(var d=c.getDomRow(a),e=0,f=d.length;f>e;e++)Fancy.get(d[e]).addClass(c.cellSelectedCls);c.fire("select")},onCellClick:function(a,b){var c=this,d=c.widget;c.cell&&(c.clearSelection(),Fancy.get(b.cell).addClass(d.cellSelectedCls),d.fire("select"))},clearSelection:function(a){var b=this,c=b.widget;if(b.checkboxRow)for(var d=c.body.el.select('.fancy-grid-column[index="0"] .'+c.cellSelectedCls),e=0,f=d.length;f>e;e++){var g=d.item(e).attr("index");b.deSelectCheckBox(g)}if(a)switch(a){case"left":c.leftBody.el.select("."+c.cellSelectedCls).removeClass(c.cellSelectedCls),c.leftBody.el.select("."+c.columnSelectedCls).removeClass(c.columnSelectedCls),c.leftBody.el.select("."+c.cellOverCls).removeClass(c.cellOverCls);break;case"center":c.body.el.select("."+c.cellSelectedCls).removeClass(c.cellSelectedCls),c.body.el.select("."+c.columnSelectedCls).removeClass(c.columnSelectedCls),c.body.el.select("."+c.cellOverCls).removeClass(c.cellOverCls);break;case"right":c.rightBody.el.select("."+c.cellSelectedCls).removeClass(c.cellSelectedCls),c.rightBody.el.select("."+c.columnSelectedCls).removeClass(c.columnSelectedCls),c.rightBody.el.select("."+c.cellOverCls).removeClass(c.cellOverCls)}else c.el.select("."+c.cellSelectedCls).removeClass(c.cellSelectedCls),c.el.select("."+c.columnSelectedCls).removeClass(c.columnSelectedCls),c.el.select("."+c.cellOverCls).removeClass(c.cellOverCls);c.fire("clearselect")},onSort:function(){var a=this;a.widget;a.clearSelection()},onCellEnterSelection:function(a,b){var c=this,d=c.widget,e=0;if(c.cells&&c.isMouseDown===!0){c.prevCellsSelection=b.cell,c.prevCellRowIndex=b.rowIndex,c.prevCellColumnIndex=b.columnIndex,c.prevCellSide=b.side;var f={rowIndex:c.startCellRowIndex,columnIndex:c.startCellColumnIndex,side:c.startCellSide},g={rowIndex:b.rowIndex,columnIndex:b.columnIndex,side:b.side};b.rowIndex<c.startCellRowIndex&&(f.rowIndex=b.rowIndex,g.rowIndex=c.startCellRowIndex),c.startCellSide===b.side?(b.columnIndex<c.startCellColumnIndex&&(f.columnIndex=b.columnIndex,g.columnIndex=c.startCellColumnIndex),e=c.selectCells(f,g,f.side),"left"===c.startCellSide?(c.clearSelection("center"),c.clearSelection("right")):"center"===c.startCellSide?(c.clearSelection("left"),c.clearSelection("right")):"right"===c.startCellSide&&(c.clearSelection("left"),c.clearSelection("center"))):"left"===c.startCellSide?(e=c.selectCells(f,{rowIndex:b.rowIndex,columnIndex:d.leftColumns.length-1},"left"),"center"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"center"),c.clearSelection("right")):"right"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},g,"right"))):"center"===c.startCellSide?"left"===b.side?(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:f.columnIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{rowIndex:g.rowIndex,columnIndex:d.leftColumns.length-1},"left")):"right"===b.side&&(e+=c.selectCells({columnIndex:f.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:g.columnIndex,rowIndex:g.rowIndex},"right")):"right"===c.startCellSide&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:f.columnIndex,rowIndex:g.rowIndex},"right"),"center"===b.side?(e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),c.clearSelection("left")):"left"===b.side&&(e+=c.selectCells({columnIndex:0,rowIndex:f.rowIndex},{columnIndex:d.columns.length-1,rowIndex:g.rowIndex},"center"),e+=c.selectCells({columnIndex:g.columnIndex,rowIndex:f.rowIndex},{columnIndex:d.leftColumns.length-1,rowIndex:g.rowIndex},"left"))),c.endCellRowIndex=g.rowIndex,d.fire("select")}},onColumnMouseDown:function(a,b){var c=this,d=c.widget;if(c.columns&&b.column.selectable!==!1&&c.enabled){var e=Fancy.get(b.columnDom);c.isMouseDown=!0,c.startColumnColumnIndex=b.columnIndex,c.startColumnSide=b.side,c.clearSelection(),e.addClass(d.columnSelectedCls),Fancy.$(document).one("mouseup",function(){delete c.isMouseDown}),d.fire("select")}},onCellMouseDownCells:function(a,b){var c=this,d=c.widget;if(d.celledit&&d.celledit.hideEditor(),c.cells&&c.enabled){var e=Fancy.get(b.cell);c.clearSelection(),e.addClass(d.cellSelectedCls),c.isMouseDown=!0,c.startCellSelection=b.cell,c.startCellRowIndex=b.rowIndex,c.startCellColumnIndex=b.columnIndex,c.startCellSide=b.side,Fancy.$(document).one("mouseup",function(){delete c.isMouseDown,delete c.startCellSelection}),d.fire("select")}},selectCells:function(a,b,c){var d,e,f,g=this,h=g.widget,i=h.body,j=h.leftBody,k=h.rightBody,l=a.rowIndex,m=b.rowIndex+1,n=g.getSelectedCells(c||"center"),o={},p={},q={};for(l=a.rowIndex,m=b.rowIndex+1;m>l;l++)for(o[l]=o[l]||{},e=a.columnIndex,f=b.columnIndex+1;f>e;e++)o[l][e]=!0;for(var r in o)if(void 0===n[r])p[r]=o[r];else for(var s in o[r])n[r][s]!==!0&&(p[r]=p[r]||{},p[r][s]=!0);for(var r in n)if(void 0===o[r])q[r]=n[r];else for(var s in n[r])o[r][s]!==!0&&(q[r]=q[r]||{},q[r][s]=!0);switch(c){case"left":d=j;break;case"center":d=i;break;case"right":d=k;break;default:d=i}for(var r in p)for(var s in p[r]){var t=d.getCell(r,s);t.addClass(h.cellSelectedCls)}for(var r in q)for(var s in q[r]){var t=d.getCell(r,s);t.removeClass(h.cellSelectedCls)}},getSelectedCells:function(a){for(var b=this,c=b.widget,d=c.getBody(a||"center"),e=d.el.select("."+c.cellSelectedCls),f={},g=0,h=e.length;h>g;g++){var i=e.item(g),j=Number(i.parent().attr("index")),k=Number(i.attr("index"));f[k]=f[k]||{},f[k][j]=!0}return f},getNumberSelectedCells:function(){var a=this,b=a.widget;return b.el.select("."+b.cellSelectedCls).length},getSelectedColumns:function(a){for(var b=this,c=b.widget,d=c.getBody(a),e={},f=d.el.select("."+c.columnSelectedCls),g=0,h=f.length;h>g;g++)e[f.item(g).attr("index")]=!0;return e},selectColumns:function(a,b,c){var d=this,e=(d.widget,d.getSelectedColumns(c||"center")),f={},g={},h={},i=a,j=b;for(i>j&&(i=b,j=a),j++;j>i;i++)f[i]=!0;for(var k in f)e[k]!==!0&&(g[k]=!0);for(var k in e)f[k]!==!0&&(h[k]=!0);for(var k in g)d.selectColumn(k,c);for(var k in h)d.deselectColumn(k,c)},selectColumn:function(a,b){var c=this,d=c.widget,e=d.getBody(b||"center"),f=Fancy.get(e.getDomColumn(a));f.addClass(d.columnSelectedCls)},deselectColumn:function(a,b){var c=this,d=c.widget,e=d.getBody(b||"center"),f=Fancy.get(e.getDomColumn(a));f.removeClass(d.columnSelectedCls)},getSelection:function(a){var b=this,c=b.widget,d=c.store,e={};switch(b.selModel){case"row":e.row=b.getSelectedRow(),-1!==e.row?(e.items=[d.get(e.row)],e.rows=[e.row]):(e.items=[],e.rows=[]);break;case"rows":e.rows=b.getSelectedRows(),e.items=[];for(var f=0,g=e.rows.length;g>f;f++)e.items.push(d.get(e.rows[f]));break;case"cells":break;case"cell":break;case"column":break;case"columns":}return a?e:e.items},renderHeaderCheckBox:function(){var a=this,b=a.widget;a._renderHeaderCheckBox(b.leftHeader,b.leftColumns),a._renderHeaderCheckBox(b.header,b.columns),a._renderHeaderCheckBox(b.rightHeader,b.rightColumns)},_renderHeaderCheckBox:function(a,b){for(var c,d=this,e=0,f=b.length;f>e;e++)if(c=b[e],"$selected"===c.index){var g=a.getCell(e).firstChild();c.headerCheckBox=new Fancy.CheckBox({renderTo:g.dom,renderId:!0,value:!1,label:!1,style:{padding:"0px",display:"inline-block"},events:[{change:function(a,b){b?d.selectAll():d.deSelectAll()}}]})}},selectAll:function(){for(var a=this,b=a.widget,c=b.el.select(".fancy-grid-cell-select .fancy-field-checkbox"),d=b.el.select(".fancy-grid-header-cell-select .fancy-field-checkbox"),e=0,f=c.length;f>e;e++){var g=Fancy.getWidget(c.item(e).attr("id"));g.setValue(!0),a.domSelectRow(e)}for(e=0,f=d.length;f>e;e++){var g=Fancy.getWidget(d.item(e).attr("id"));g.setValue(!0,!1)}},deSelectAll:function(){for(var a=this,b=a.widget,c=b.el.select(".fancy-grid-cell-select .fancy-field-checkbox"),d=(b.el.select(".fancy-grid-header-cell-select .fancy-field-checkbox"),0),e=c.length;e>d;d++){var f=Fancy.getWidget(c.item(d).attr("id"));f.setValue(!1),a.domDeSelectRow(d)}a.clearHeaderCheckBox()},clearHeaderCheckBox:function(){for(var a=this,b=a.widget,c=b.el.select(".fancy-grid-header-cell-select .fancy-field-checkbox"),d=0,e=c.length;e>d;d++){var f=Fancy.getWidget(c.item(d).attr("id"));f.setValue(!1,!1)}},stopSelection:function(){this.enabled=!1},enableSelection:function(a){var b=this;return void 0!==a?void(b.enabled=a):void(b.enabled=!0)}});