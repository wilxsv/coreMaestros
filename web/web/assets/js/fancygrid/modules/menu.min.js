!function(){Fancy.define("Fancy.Menu",{extend:Fancy.Widget,constructor:function(a,b){var c=this;Fancy.applyConfig(c,a||{}),c.Super("const",arguments)},init:function(){var a=this;a.addEvents("hide"),a.Super("init",arguments),a.applyDefaults(),a.render(),a.ons()},ons:function(){var a=this,b=a.el;b.on("mousedown",a.onItemMouseDown,a,".fancy-menu-item"),b.on("click",a.onItemClick,a,".fancy-menu-item"),b.on("mouseenter",a.onItemEnter,a,".fancy-menu-item"),b.on("mouseleave",a.onItemLeave,a,".fancy-menu-item")},widgetCls:"fancy-menu",itemCls:"fancy-menu-item",itemImageCls:"fancy-menu-item-image",itemContainerCls:"fancy-menu-item-text",activeItemCls:"fancy-menu-item-active",cls:"",extraCls:"",width:142,itemHeight:30,rendered:!1,theme:"default",render:function(){var a,b=this,c=Fancy.get(document.createElement("div"));b.fire("beforerender"),"default"!==b.theme&&c.addClass("fancy-theme-"+b.theme),c.addClass(Fancy.cls),c.addClass(b.widgetCls),c.addClass(b.cls),c.addClass(b.extraCls),c.css("width",b.width),c.css("height",b.getItemsHeight()),a=Fancy.get(b.renderTo||document.body),b.el=a.dom.appendChild(c.dom),b.el=Fancy.get(b.el),b.renderItems(),b.fire("afterrender"),b.fire("render"),b.rendered=!0},getItemsHeight:function(){for(var a=this,b=0,c=0,d=a.items.length;d>c;c++)b+=a.itemHeight;return b},renderItems:function(){for(var a,b=this,c=0,d=b.items.length;d>c;c++){a=b.items[c];var e=Fancy.get(document.createElement("div"));e.attr("index",c),e.addClass(b.itemCls),e.css("height",b.itemHeight),b.el.dom.appendChild(e.dom),a.el=e;var f=a.imageCls||"";switch(a.cls&&e.addClass(a.cls),e.update([a.image===!1?"":'<div class="fancy-menu-item-image '+f+'"></div>','<div class="fancy-menu-item-text"></div>','<div class="fancy-menu-item-right-image '+(a.items?"fancy-menu-item-expand":"")+'"></div>'].join("")),a.image===!1&&e.addClass("fancy-menu-item-no-image"),a.type){case"":break;default:e.select(".fancy-menu-item-text").item(0).update(a.text||"")}void 0!==a.checked&&(b.items[c].checkbox=new Fancy.CheckBox({label:!1,theme:b.theme,padding:"1px 8px 0px",renderTo:e.select(".fancy-menu-item-image").item(0).dom,value:a.checked}))}},applyDefaults:function(){var a=this,b=0,c=a.items.length;if(a.defaults)for(;c>b;b++)Fancy.applyIf(a.items[b],a.defaults)},onItemClick:function(a){var b=this,c=(b.items.length,Fancy.get(a.currentTarget)),d=c.attr("index"),e=b.items[d],f=[b,e];e.handler&&(e.scope?e.handler.apply(e.scope,f):e.handler(b,e))},onItemEnter:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index"),e=b.items[d],f=c.offset();if(b.shownSubMenu&&b.shownSubMenu.hide(),b.deActivateItem(),b.activateItem(d),e.items){if(!e.menu){var g=b.items[d];Fancy.apply(g,{parentItem:e,parentMenu:b,defaults:e.defaults,items:e.items,theme:b.theme}),b.items[d].menu=new Fancy.Menu(g)}e.menu.showAt(f.left+parseInt(c.width()),f.top),b.shownSubMenu=e.menu}},onItemLeave:function(a){var b=this,c=Fancy.get(a.currentTarget),d=c.attr("index");b.items[d]},showAt:function(a,b){var c=this;c.css("position","absolute"),c.css("left",a),c.css("top",b),c.el.show(),c.parentMenu||Fancy.MenuManager.add(c)},hide:function(){var a=this;a.el.hide(),a.deActivateItem(),a.shownSubMenu&&a.shownSubMenu.hide(),a.fire("hide")},hideAll:function(){var a=this;a.parentMenu&&"none"!==a.parentMenu.el.css("display")&&a.parentMenu.hide(),a.hide()},activateItem:function(a){var b=this,c=b.items[a];b.activeItem=c,c.el.addClass(b.activeItemCls)},deActivateItem:function(){var a=this;a.activeItem&&(a.activeItem.el.removeClass(a.activeItemCls),delete a.activeItem)},onItemMouseDown:function(a){a.preventDefault()}}),Fancy.define("Fancy.MenuManager",{singleton:!0,inited:!1,constructor:function(a){},init:function(){var a=this,b=Fancy.get(document);b.on("click",a.onDocClick,a)},add:function(a){var b=this;b.inited||b.init(),b.activeMenu=a},onDocClick:function(a){var b=this,c=Fancy.get(a.target),d=10,e=c;if(b.activeMenu){for(;d>0&&e.dom;){if(e.hasClass("fancy-menu"))return;e=e.parent(),d--}b.activeMenu.hide(),delete b.activeMenu}}})}(),Fancy.Mixin("Fancy.grid.header.mixin.Menu",{triggeredColumnCls:"fancy-grid-header-column-triggered",showMenu:function(a,b,c,d){var e=this,f=e.widget,g=a.offset();e.hideMenu(),a.addClass(e.triggeredColumnCls),c.menu.rendered?e.updateColumnsMenu(c,d):(c.menu=e.generateMenu(c,d),c.menu=new Fancy.Menu({column:c,items:c.menu,theme:f.theme,events:[{hide:e.onMenuHide,scope:e}]})),c.menu.showAt(g.left+parseInt(a.css("width"))-26,g.top+parseInt(a.css("height"))-1),e.activeMenu=c.menu,e.activeCell=a},hideMenu:function(){var a=this,b=a.widget;switch(a.side){case"left":b.header.activeMenu&&(b.header.activeMenu.hide(),b.header.activeCell.removeClass(a.triggeredColumnCls),delete b.header.activeMenu,delete b.header.activeCell),b.rightHeader.activeMenu&&(b.rightHeader.activeMenu.hide(),b.rightHeader.activeCell.removeClass(a.triggeredColumnCls),delete b.rightHeader.activeMenu,delete b.rightHeader.activeCell);break;case"center":b.leftHeader.activeMenu&&(b.leftHeader.activeMenu.hide(),b.leftHeader.activeCell.removeClass(a.triggeredColumnCls),delete b.leftHeader.activeMenu,delete b.leftHeader.activeCell),b.rightHeader.activeMenu&&(b.rightHeader.activeMenu.hide(),b.rightHeader.activeCell.removeClass(a.triggeredColumnCls),delete b.rightHeader.activeMenu,delete b.rightHeader.activeCell);break;case"right":b.leftHeader.activeMenu&&(b.leftHeader.activeMenu.hide(),b.leftHeader.activeCell.removeClass(a.triggeredColumnCls),delete b.leftHeader.activeMenu,delete b.leftHeader.activeCell),b.header.activeMenu&&(b.header.activeMenu.hide(),b.header.activeCell.removeClass(a.triggeredColumnCls),delete b.header.activeMenu,delete b.header.activeCell)}a.activeMenu&&(a.activeMenu.hide(),a.activeCell.removeClass(a.triggeredColumnCls)),delete a.activeMenu,delete a.activeCell},generateMenu:function(a,b){for(var c,d=this,e=d.widget,f=e.lang,g=(e.theme,[]),h="",i=0,j=b.length;j>i;i++)if(a.index===b[i].index){c=i;break}switch(a.sortable===!1&&(h="fancy-menu-item-disabled"),g.push({text:f.sortAsc,cls:h,imageCls:"fancy-grid-header-cell-trigger-up",handler:function(){e.sorter.sort("asc",a.index,d.side),a.menu.hide()}}),g.push({text:f.sortDesc,cls:h,imageCls:"fancy-grid-header-cell-trigger-down",handler:function(){e.sorter.sort("desc",a.index,d.side),a.menu.hide()}}),g.push({text:f.columns,index:"columns",items:d.prepareColumns(b)}),d.side){case"left":case"right":g.push({text:"Unlock",handler:function(){a.menu.hide(),e.unLockColumn(c,d.side)}});break;case"center":e.leftColumns.length&&a.lockable!==!1&&g.push({text:"Lock",handler:function(){a.menu.hide(),e.lockColumn(c,d.side)}}),e.rightColumns.length&&a.lockable!==!1&&g.push({text:"Right Lock",handler:function(){a.menu.hide(),e.rightLockColumn(c,d.side)}})}return g},prepareColumns:function(a){for(var b,c=this,d=c.widget,e=[],f=0,g=a.length,h=[];g>f;f++){var i=!0,j=a[f];j.hidden&&(i=!1);var k={text:j.title,checked:i,index:j.index,handler:function(a,b){var e=!b.checked;return b.checked!==!0||b.checkbox.get()||(e=!0,b.checkbox.set(!0)),b.checked&&1===a.el.select(".fancy-checkbox-on").length?(e=!0,void b.checkbox.set(!0)):(b.checked=!b.checked,b.checkbox.set(b.checked),void(b.checked?d.showColumn(c.side,b.index):d.hideColumn(c.side,b.index)))}};j.grouping?(h=h||[],h.push(k),b=j.grouping):(h.length&&(b=void 0,e.push({text:j.title,items:h}),h=[]),e.push(k))}return e},onMenuHide:function(){var a=this,b="fancy-grid-header-column-triggered";a.el.select("."+b).removeClass(b)},updateColumnsMenu:function(a,b,c){for(var d,e,f=this,g=a.menu,h=0,i=g.items.length;i>h;h++)if(e=g.items[h],"columns"===e.index){d=e;break}h=0,i=d.items.length;for(var j=!1;i>h;h++){e=d.items[h];var k=b[h];e.checkbox&&(e.checkbox.set(!k.hidden,!1),j=!0)}j||c||(d.items=f.prepareColumns(b))}});